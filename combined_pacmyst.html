<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PACMYST</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            overflow: hidden;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        /* Welcome Screen Styles */
        .welcome-screen {
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            position: relative;
            z-index: 1000;
        }

        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                        radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                        radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                        radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: stars 20s linear infinite;
        }

        @keyframes stars {
            from { transform: translateY(0px); }
            to { transform: translateY(-100px); }
        }

        .welcome-container {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 20px;
        }

        .arcade-border {
            border: 8px solid #00FFFF;
            border-radius: 20px;
            padding: 60px 40px;
            background: linear-gradient(135deg, 
                rgba(255, 20, 147, 0.9), 
                rgba(255, 99, 71, 0.9), 
                rgba(255, 215, 0, 0.9), 
                rgba(50, 205, 50, 0.9), 
                rgba(0, 191, 255, 0.9), 
                rgba(147, 112, 219, 0.9));
            box-shadow: 
                0 0 20px #00FFFF,
                inset 0 0 20px rgba(0, 255, 255, 0.2),
                0 0 40px rgba(0, 191, 255, 0.4);
            animation: glow 2s ease-in-out infinite alternate;
            max-width: 800px;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px #00FFFF, inset 0 0 20px rgba(0, 255, 255, 0.2), 0 0 40px rgba(0, 191, 255, 0.4); }
            to { box-shadow: 0 0 30px #FF1493, inset 0 0 30px rgba(255, 20, 147, 0.3), 0 0 60px rgba(255, 20, 147, 0.5); }
        }

        .game-logo {
            font-size: 4em;
            font-family: 'Arial Black', 'Arial', sans-serif;
            font-weight: 900;
            background: linear-gradient(45deg, #FF1493, #FF6347, #FFD700, #32CD32, #00BFFF, #9370DB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 4px 4px 0px #000, 8px 8px 0px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            letter-spacing: 4px;
            text-transform: uppercase;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            font-size: 1.4em;
            color: #00FFFF;
            text-shadow: 2px 2px 0px #000;
            margin-bottom: 20px;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .description {
            font-size: 1.1em;
            color: #FFFFFF;
            text-shadow: 1px 1px 0px #000;
            margin-bottom: 40px;
            line-height: 1.6;
            max-width: 600px;
            font-weight: 500;
        }

        .play-button {
            background: linear-gradient(45deg, #FF1493 0%, #FF6347 25%, #FFD700 50%, #32CD32 75%, #00BFFF 100%);
            color: #000;
            border: 6px solid #000;
            padding: 25px 60px;
            font-size: 2em;
            font-family: 'Arial Black', 'Arial', sans-serif;
            font-weight: 900;
            cursor: pointer;
            border-radius: 20px;
            box-shadow: 
                0 8px 0px #000,
                0 12px 20px rgba(0,0,0,0.4);
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .play-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: shine 3s linear infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .play-button:hover {
            background: linear-gradient(45deg, #FF6347 0%, #FFD700 25%, #32CD32 50%, #00BFFF 75%, #9370DB 100%);
            transform: translateY(-4px);
            box-shadow: 
                0 12px 0px #000,
                0 16px 25px rgba(0,0,0,0.5);
        }

        .play-button:active {
            transform: translateY(4px);
            box-shadow: 
                0 4px 0px #000,
                0 6px 15px rgba(0,0,0,0.3);
        }

        .controls-info {
            margin-top: 40px;
            font-size: 1em;
            color: #00FF00;
            text-shadow: 1px 1px 0px #000;
            border: 2px solid #00FF00;
            padding: 15px 25px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
            font-weight: 500;
        }

        .controls-info p {
            margin: 5px 0;
        }

        .version-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 0.9em;
            color: #888;
            text-shadow: 1px 1px 0px #000;
        }

        /* Game Screen Styles */
        .game-screen {
            background: linear-gradient(135deg, #FF1493, #FF6347, #FFD700, #32CD32, #00BFFF, #9370DB);
            color: #fff;
            font-family: 'Courier New', monospace;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            overflow-x: hidden;
        }

        .game-container {
            text-align: center;
            width: 100%;
            max-width: 800px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .game-header {
            margin-bottom: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-title {
            font-size: 3.5em;
            font-family: 'Arial Black', 'Arial', sans-serif;
            font-weight: 900;
            background: linear-gradient(45deg, #FF1493, #FF6347, #FFD700, #32CD32, #00BFFF, #9370DB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 4px 4px 0px #000;
            margin-bottom: 15px;
            letter-spacing: 4px;
            text-transform: uppercase;
            text-align: center;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            width: 100%;
            max-width: 600px;
            min-width: 400px;
        }

        .score, .lives, .level {
            color: #FFD700;
            text-shadow: 2px 2px 0px #000;
            font-weight: bold;
        }

        #gameCanvas {
            border: 6px solid #000;
            background: #000;
            box-shadow: 
                0 0 40px rgba(255, 20, 147, 0.8), 
                0 0 80px rgba(50, 205, 50, 0.6), 
                0 0 120px rgba(0, 191, 255, 0.4),
                inset 0 0 20px rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            display: block;
            margin: 0 auto;
        }

        .game-controls {
            margin-top: 20px;
            font-size: 1em;
            color: #fff;
            background: rgba(0, 0, 0, 0.6);
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
        }

        .mobile-controls {
            display: none;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border: 2px solid #ff0000;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 2000;
            max-width: 90vw;
        }

        .game-over h2 {
            color: #ff0000;
            margin-bottom: 15px;
            font-size: 2em;
        }

        .name-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #FFD700;
            color: #fff;
            padding: 10px;
            font-size: 1.2em;
            border-radius: 5px;
            margin: 10px;
            text-align: center;
            width: 200px;
        }

        .leaderboard {
            margin: 20px 0;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
        }

        .leaderboard h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }

        .leaderboard-entry {
            padding: 5px;
            border-bottom: 1px solid #333;
        }

        .restart-btn {
            background: #0066ff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            touch-action: manipulation;
        }

        .restart-btn:hover {
            background: #0088ff;
        }

        .restart-btn:active {
            transform: scale(0.95);
        }

        .desktop-controls {
            display: inline;
        }

        .mobile-controls-text {
            display: none;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .arcade-border {
                padding: 30px 20px;
                margin: 10px;
                border-width: 6px;
            }

            .game-logo {
                font-size: 2.5em;
                letter-spacing: 2px;
                margin-bottom: 20px;
                line-height: 1.1;
            }
            
            .subtitle {
                font-size: 1.1em;
                margin-bottom: 15px;
            }

            .description {
                font-size: 1em;
                margin-bottom: 30px;
                line-height: 1.5;
            }
            
            .play-button {
                font-size: 1.6em;
                padding: 20px 40px;
                letter-spacing: 1px;
            }

            .controls-info {
                font-size: 0.9em;
                padding: 12px 18px;
                margin-top: 30px;
            }

            .version-info {
                font-size: 0.8em;
                bottom: 10px;
                right: 10px;
            }

            .game-container {
                max-width: 100%;
            }

            .game-title {
                font-size: 2.2em;
                letter-spacing: 2px;
                margin-bottom: 12px;
                line-height: 1.1;
            }
            
            .game-stats {
                font-size: 1em;
                padding: 12px 15px;
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 15px;
                min-width: auto;
                width: 95%;
            }
            
            .game-stats > div {
                flex: 1;
                min-width: 80px;
                font-size: 0.95em;
            }

            .game-controls {
                font-size: 0.85em;
                margin-top: 15px;
                padding: 10px 15px;
                width: 95%;
            }

            .game-over {
                padding: 20px;
                max-width: 95vw;
                max-height: 90vh;
                overflow-y: auto;
            }

            .game-over h2 {
                font-size: 1.8em;
                margin-bottom: 12px;
            }

            .name-input {
                width: 160px;
                font-size: 1em;
                padding: 10px;
            }

            .restart-btn {
                padding: 12px 20px;
                font-size: 1em;
                margin: 5px;
            }

            .leaderboard {
                font-size: 0.9em;
                max-height: 180px;
                margin: 18px 0;
            }
        }

        @media (max-width: 480px) {
            .arcade-border {
                padding: 25px 15px;
                margin: 5px;
                border-width: 4px;
            }

            .game-logo {
                font-size: 2em;
                letter-spacing: 1px;
                margin-bottom: 15px;
            }
            
            .subtitle {
                font-size: 1em;
                margin-bottom: 12px;
            }

            .description {
                font-size: 0.9em;
                margin-bottom: 25px;
            }
            
            .play-button {
                font-size: 1.4em;
                padding: 18px 35px;
                letter-spacing: 1px;
            }

            .controls-info {
                font-size: 0.8em;
                padding: 10px 15px;
                margin-top: 25px;
            }

            .game-title {
                font-size: 1.8em;
                letter-spacing: 1px;
            }

            .game-stats {
                font-size: 0.9em;
                padding: 10px 12px;
                gap: 6px;
            }

            .game-stats > div {
                font-size: 0.9em;
                min-width: 70px;
            }

            .game-controls {
                font-size: 0.8em;
                margin-top: 12px;
                padding: 8px 12px;
            }

            .game-over {
                padding: 15px;
            }

            .game-over h2 {
                font-size: 1.5em;
            }

            .name-input {
                width: 140px;
                font-size: 0.9em;
                padding: 8px;
            }

            .restart-btn {
                padding: 10px 16px;
                font-size: 0.95em;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="starfield"></div>
        
        <div class="welcome-container">
            <div class="arcade-border">
                <h1 class="game-logo">PACMYST</h1>
                <h2 class="subtitle">MYSTICAL ARCADE ADVENTURE</h2>
                <p class="description">
                    Navigate the cosmic maze as PacMyst! Collect basedness and avoid the ghosts. 
                    Use Whirl power-ups, and chase them down!! Good Luck and Stay based
                </p>
                
                <button class="play-button" onclick="launchGame()">
                    <span>PLAY GAME</span>
                </button>
                
                <div class="controls-info">
                    <p><strong>MYSTCADE:</strong> PacMyst</p>
                    <p><strong>GOAL:</strong> Collect all tokens to advance!</p>
                    <p><strong>POWER-UPS:</strong> Chase the ghouls!</p>
                </div>
            </div>
        </div>
        
        <div class="version-info">
            PACMYST v1.0 | OK Computer Terminal Ready
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-screen" id="gameScreen">
        <div class="game-container">
            <div class="game-header">
                <h1 class="game-title">PACMYST</h1>
                <div class="game-stats">
                    <div class="score">Score: <span id="score">0</span></div>
                    <div class="level">Level: <span id="level">1</span></div>
                    <div class="lives">Lives: <span id="lives">3</span></div>
                </div>
            </div>
            
            <canvas id="gameCanvas" width="600" height="600"></canvas>
            
            <div class="game-controls" id="gameControls">
                <span class="desktop-controls" id="desktopControls">Desktop: Arrow Keys or WASD</span>
                <span class="mobile-controls-text" id="mobileControlsText">Mobile: Swipe screen</span>
            </div>
        </div>

        <div class="mobile-controls" id="mobileControls" style="display: none;">
            <!-- Hidden - only swipe controls on mobile -->
        </div>

        <div class="game-over" id="gameOver">
            <h2>Game Over</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>Level Reached: <span id="finalLevel">1</span></p>
            <input type="text" class="name-input" id="playerName" placeholder="Enter your name" maxlength="15">
            <br>
            <button class="restart-btn" onclick="saveScore()">Save Score</button>
            <button class="restart-btn" onclick="restartGame()">Play Again</button>
            <button class="restart-btn" onclick="backToWelcome()">Main Menu</button>
            
            <div class="leaderboard" id="leaderboard">
                <h3>🏆 MYSTCL Leaderboard</h3>
                <div id="leaderboardList"></div>
            </div>
        </div>
    </div>

    <script>
        // Screen transition functions
        function launchGame() {
            const button = document.querySelector('.play-button');
            button.style.transform = 'translateY(4px)';
            button.style.boxShadow = '0 4px 0px #000, 0 6px 15px rgba(0,0,0,0.3)';
            
            setTimeout(() => {
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'flex';
                initializeGame();
            }, 300);
        }

        function backToWelcome() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'flex';
            if (window.game) {
                window.game.gameRunning = false;
            }
        }

        function initializeGame() {
            window.game = new PacmystGame();
        }

        // Game code
        class PacmystGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.scoreElement = document.getElementById('score');
                this.livesElement = document.getElementById('lives');
                this.levelElement = document.getElementById('level');
                
                this.gridSize = 40;
                this.rows = 15;
                this.cols = 15;
                
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                this.gameRunning = false;
                this.powerMode = false;
                this.powerModeTimer = 0;
                
                this.touchStartX = 0;
                this.touchStartY = 0;
                this.touchThreshold = 30;
                
                this.leaderboard = [
                    { name: "MYSTCL", score: 1000, level: 5 },
                    { name: "Unicorn", score: 800, level: 4 },
                    { name: "Pixie", score: 600, level: 3 }
                ];
                
                this.maze = this.createMaze();
                this.player = { x: 7, y: 11, direction: -1, nextDirection: -1 };
                this.ghosts = [
                    { x: 7, y: 6, direction: 0, color: '#ff0000', mode: 'scatter' },
                    { x: 6, y: 6, direction: 2, color: '#ffb8ff', mode: 'scatter' },
                    { x: 8, y: 6, direction: 2, color: '#00ffff', mode: 'scatter' },
                    { x: 7, y: 7, direction: 1, color: '#ffb852', mode: 'scatter' }
                ];
                
                this.directions = [
                    { x: 0, y: -1 },
                    { x: 1, y: 0 },
                    { x: 0, y: 1 },
                    { x: -1, y: 0 }
                ];
                
                this.setupEventListeners();
                this.setupTouchControls();
                this.setupCanvas();
                this.detectDeviceAndSetupControls();
                this.startGame();
            }
            
            setupCanvas() {
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile) {
                    const size = Math.min(window.innerWidth - 40, 500);
                    this.canvas.width = size;
                    this.canvas.height = size;
                    this.canvas.style.width = size + 'px';
                    this.canvas.style.height = size + 'px';
                } else {
                    const size = Math.min(window.innerWidth * 0.7, 550);
                    this.canvas.width = size;
                    this.canvas.height = size;
                    this.canvas.style.width = size + 'px';
                    this.canvas.style.height = size + 'px';
                }
                
                this.gridSize = this.canvas.width / this.cols;
            }
            
            detectDeviceAndSetupControls() {
                const isMobile = 'ontouchstart' in window || 
                                navigator.maxTouchPoints > 0 || 
                                window.innerWidth <= 768;
                
                const desktopControls = document.getElementById('desktopControls');
                const mobileControlsText = document.getElementById('mobileControlsText');
                
                if (isMobile) {
                    desktopControls.style.display = 'none';
                    mobileControlsText.style.display = 'inline';
                } else {
                    desktopControls.style.display = 'inline';
                    mobileControlsText.style.display = 'none';
                }
            }
            
            setupTouchControls() {
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (!this.gameRunning) return;
                    
                    const touch = e.touches[0];
                    this.touchStartX = touch.clientX;
                    this.touchStartY = touch.clientY;
                }, { passive: false });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (!this.gameRunning) return;
                    
                    const touch = e.changedTouches[0];
                    const deltaX = touch.clientX - this.touchStartX;
                    const deltaY = touch.clientY - this.touchStartY;
                    
                    if (Math.abs(deltaX) > this.touchThreshold || Math.abs(deltaY) > this.touchThreshold) {
                        if (Math.abs(deltaX) > Math.abs(deltaY)) {
                            this.player.nextDirection = deltaX > 0 ? 1 : 3;
                        } else {
                            this.player.nextDirection = deltaY > 0 ? 2 : 0;
                        }
                    }
                }, { passive: false });
                
                document.addEventListener('touchend', (e) => {
                    if (e.target.closest('.game-container')) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
            
            createMaze() {
                const maze = Array(this.rows).fill().map(() => Array(this.cols).fill(1));
                
                for (let y = 0; y < this.rows; y++) {
                    for (let x = 0; x < this.cols; x++) {
                        if (x === 0 || x === this.cols - 1 || y === 0 || y === this.rows - 1) {
                            maze[y][x] = 0;
                        }
                        else if (this.level === 1) {
                            if ((x === 3 && y >= 3 && y <= 5) ||
                                (x === 11 && y >= 3 && y <= 5) ||
                                (x === 3 && y >= 9 && y <= 11) ||
                                (x === 11 && y >= 9 && y <= 11) ||
                                (y === 3 && x >= 6 && x <= 8) ||
                                (y === 11 && x >= 6 && x <= 8)) {
                                maze[y][x] = 0;
                            }
                            else if (x >= 6 && x <= 8 && y >= 5 && y <= 7) {
                                maze[y][x] = 3;
                            }
                            else if ((x === 2 && y === 2) || (x === 12 && y === 2) || 
                                    (x === 2 && y === 12) || (x === 12 && y === 12)) {
                                maze[y][x] = 2;
                            }
                            else {
                                maze[y][x] = 1;
                            }
                        }
                        else {
                            if (x >= 6 && x <= 8 && y >= 5 && y <= 7) {
                                maze[y][x] = 3;
                            }
                            else if ((x === 2 && y === 2) || (x === 12 && y === 2) || 
                                    (x === 2 && y === 12) || (x === 12 && y === 12)) {
                                maze[y][x] = 2;
                            }
                            else if (x > 1 && x < this.cols - 2 && y > 1 && y < this.rows - 2) {
                                if (Math